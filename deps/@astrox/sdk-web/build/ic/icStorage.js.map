{"version":3,"sources":["../../../src/ic/icStorage.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/explicit-module-boundary-types */\nimport { AbstractedClientStorage } from '@astrox/sdk-core';\n\nexport const KEY_ICSTORAGE_KEY = 'identity';\nexport const KEY_ICSTORAGE_DELEGATION = 'delegation';\nexport const KEY_ICSTORAGE_WALLET = 'wallet';\nexport const KEY_DELEGATION_PARAMS = 'delegation_params'\nexport const IDENTITY_PROVIDER_DEFAULT = 'https://identity.ic0.app';\nexport const IDENTITY_PROVIDER_ENDPOINT = '#authorize';\n\nexport async function _deleteStorage(storage: AbstractedClientStorage) {\n  await storage.remove(KEY_ICSTORAGE_KEY);\n  await storage.remove(KEY_ICSTORAGE_DELEGATION);\n  await storage.remove(KEY_ICSTORAGE_WALLET);\n  await storage.remove(KEY_DELEGATION_PARAMS);\n}\n\nexport class ICStorage implements AbstractedClientStorage {\n  constructor(public readonly prefix = 'astrox-', private readonly _localStorage?: Storage) {}\n\n  public get(key: string): Promise<string | null> {\n    return Promise.resolve(this._getICStorage().getItem(this.prefix + key));\n  }\n\n  public set(key: string, value: string): Promise<void> {\n    this._getICStorage().setItem(this.prefix + key, value);\n    return Promise.resolve();\n  }\n\n  public remove(key: string): Promise<void> {\n    this._getICStorage().removeItem(this.prefix + key);\n    return Promise.resolve();\n  }\n\n  private _getICStorage() {\n    if (this._localStorage) {\n      return this._localStorage;\n    }\n\n    const ls =\n      typeof window === 'undefined'\n        ? typeof global === 'undefined'\n          ? typeof self === 'undefined'\n            ? undefined\n            : self.localStorage\n          : global.localStorage\n        : window.localStorage;\n\n    if (!ls) {\n      throw new Error('Could not find local storage.');\n    }\n\n    return ls;\n  }\n}\n"],"names":["KEY_ICSTORAGE_KEY","KEY_ICSTORAGE_DELEGATION","KEY_ICSTORAGE_WALLET","KEY_DELEGATION_PARAMS","IDENTITY_PROVIDER_DEFAULT","IDENTITY_PROVIDER_ENDPOINT","_deleteStorage","storage","remove","ICStorage","constructor","prefix","_localStorage","get","key","Promise","resolve","_getICStorage","getItem","set","value","setItem","removeItem","ls","window","global","self","undefined","localStorage","Error"],"mappings":"AAGA,OAAO,MAAMA,oBAAoB,WAAW;AAC5C,OAAO,MAAMC,2BAA2B,aAAa;AACrD,OAAO,MAAMC,uBAAuB,SAAS;AAC7C,OAAO,MAAMC,wBAAwB,oBAAmB;AACxD,OAAO,MAAMC,4BAA4B,2BAA2B;AACpE,OAAO,MAAMC,6BAA6B,aAAa;AAEvD,OAAO,eAAeC,eAAeC,OAAgC;IACnE,MAAMA,QAAQC,MAAM,CAACR;IACrB,MAAMO,QAAQC,MAAM,CAACP;IACrB,MAAMM,QAAQC,MAAM,CAACN;IACrB,MAAMK,QAAQC,MAAM,CAACL;AACvB;AAEA,OAAO,MAAMM;;;IACXC,YAAY,AAAgBC,SAAS,SAAS,EAAE,AAAiBC,aAAuB,CAAE;aAA9DD,SAAAA;aAAqCC,gBAAAA;IAA0B;IAEpFC,IAAIC,GAAW,EAA0B;QAC9C,OAAOC,QAAQC,OAAO,CAAC,IAAI,CAACC,aAAa,GAAGC,OAAO,CAAC,IAAI,CAACP,MAAM,GAAGG;IACpE;IAEOK,IAAIL,GAAW,EAAEM,KAAa,EAAiB;QACpD,IAAI,CAACH,aAAa,GAAGI,OAAO,CAAC,IAAI,CAACV,MAAM,GAAGG,KAAKM;QAChD,OAAOL,QAAQC,OAAO;IACxB;IAEOR,OAAOM,GAAW,EAAiB;QACxC,IAAI,CAACG,aAAa,GAAGK,UAAU,CAAC,IAAI,CAACX,MAAM,GAAGG;QAC9C,OAAOC,QAAQC,OAAO;IACxB;IAEQC,gBAAgB;QACtB,IAAI,IAAI,CAACL,aAAa,EAAE;YACtB,OAAO,IAAI,CAACA,aAAa;QAC3B;QAEA,MAAMW,KACJ,OAAOC,WAAW,cACd,OAAOC,WAAW,cAChB,OAAOC,SAAS,cACdC,YACAD,KAAKE,YAAY,GACnBH,OAAOG,YAAY,GACrBJ,OAAOI,YAAY;QAEzB,IAAI,CAACL,IAAI;YACP,MAAM,IAAIM,MAAM;QAClB;QAEA,OAAON;IACT;AACF"}